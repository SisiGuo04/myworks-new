document.addEventListener("DOMContentLoaded",(()=>{initCarousel();setupModals();initImages();document.getElementById("currentYear").textContent=(new Date).getFullYear()}));let currentIndex=0;const slideCount=7;function initCarousel(){const track=document.querySelector(".carousel-track");const slides=document.querySelectorAll(".carousel-slide");const nextButton=document.querySelector(".carousel-button.next");const prevButton=document.querySelector(".carousel-button.prev");const dots=document.querySelectorAll(".dot");updateCarousel();const lazyLoadObserver=new IntersectionObserver(((entries,observer)=>{entries.forEach((entry=>{if(entry.isIntersecting){const slide=entry.target;const img=slide.querySelector("img");if(img.dataset.src){img.src=img.dataset.src;img.removeAttribute("data-src")}observer.unobserve(slide)}}))}),{threshold:.1});slides.forEach((slide=>{lazyLoadObserver.observe(slide)}));function preloadNextImage(){const nextIndex=(currentIndex+1)%slideCount;const nextSlide=slides[nextIndex];const nextImg=nextSlide.querySelector("img");if(nextImg.dataset.src){const preloadImg=new Image;preloadImg.src=nextImg.dataset.src}}nextButton.addEventListener("click",(()=>{currentIndex=(currentIndex+1)%slideCount;updateCarousel();preloadNextImage()}));prevButton.addEventListener("click",(()=>{currentIndex=(currentIndex-1+slideCount)%slideCount;updateCarousel();preloadNextImage()}));dots.forEach(((dot,index)=>{dot.addEventListener("click",(()=>{currentIndex=index;updateCarousel()}))}));let touchStartX=0;let touchEndX=0;track.addEventListener("touchstart",(e=>{touchStartX=e.touches[0].clientX}),{passive:true});track.addEventListener("touchend",(e=>{touchEndX=e.changedTouches[0].clientX;const diff=touchStartX-touchEndX;if(Math.abs(diff)>50){if(diff>0){currentIndex=(currentIndex+1)%slideCount}else{currentIndex=(currentIndex-1+slideCount)%slideCount}updateCarousel()}}))}function updateCarousel(){const track=document.querySelector(".carousel-track");const dots=document.querySelectorAll(".dot");track.style.transform=`translateX(-${currentIndex*(100/slideCount)}%)`;dots.forEach(((dot,index)=>{dot.classList.toggle("active",index===currentIndex)}))}function setupModals(){const wechatBtn=document.getElementById("wechat-btn");const blogBtn=document.getElementById("blog-btn");const wechatModal=document.getElementById("wechat-modal");const blogModal=document.getElementById("blog-modal");const carouselModal=document.getElementById("carousel-modal");setupModal(wechatBtn,wechatModal,"wechat-close");setupModal(blogBtn,blogModal,"blog-close");document.querySelectorAll(".carousel-slide").forEach((slide=>{slide.addEventListener("click",(()=>{const modalImg=document.getElementById("carousel-modal-img");const modalTitle=document.getElementById("carousel-modal-title");const modalDesc=document.getElementById("carousel-modal-desc");modalImg.src=slide.querySelector("img").src;modalTitle.textContent=slide.querySelector(".slide-caption h3").textContent;modalDesc.textContent=slide.querySelector(".slide-caption p").textContent;showModal(carouselModal)}))}));document.addEventListener("keydown",(e=>{if(e.key==="Escape"){hideModal(wechatModal);hideModal(blogModal);hideModal(carouselModal)}}))}function setupModal(trigger,modal,closeId){if(!trigger||!modal)return;const closeBtn=document.getElementById(closeId);trigger.addEventListener("click",(()=>showModal(modal)));if(closeBtn){closeBtn.addEventListener("click",(()=>hideModal(modal)))}modal.addEventListener("click",(e=>{if(e.target===modal){hideModal(modal)}}))}function showModal(modal){if(!modal)return;modal.style.display="flex";document.body.style.overflow="hidden";setTimeout((()=>{modal.classList.add("active")}),10)}function hideModal(modal){if(!modal)return;modal.classList.remove("active");setTimeout((()=>{modal.style.display="none";document.body.style.overflow="auto"}),300)}function handleImageError(img){img.onerror=function(){if(img.src.endsWith(".webp")){img.src=img.src.replace(".webp",".png")}else if(img.src.endsWith(".png")){img.src=img.src.replace(".png",".jpg")}}}function initImages(){const images=document.querySelectorAll("img");images.forEach((img=>{img.classList.add("loading");img.onload=function(){img.classList.remove("loading");img.classList.add("loaded")};handleImageError(img);img.loading="lazy"}))}